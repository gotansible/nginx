---
# defaults file for nginx

nginx_service_name: nginx

nginx_user: nginx
nginx_group: nginx

nginx_version: 1.7.6
nginx_source_url_root: http://nginx.org/download
nginx_source_filename: nginx-{{ nginx_version }}.tar.gz
nginx_source_checksum: 08e2efc169c9f9d511ce53ea16f17d8478ab9b0f7a653f212c03c61c52101599
nginx_bin: /usr/local/sbin/nginx
nginx_build_folder: /tmp/nginx
nginx_pid: /var/run/nginx.pid

nginx_openssl_hdparam_bits: 2048
nginx_txid_module_path: "{{ nginx_build_folder}}/ngx_txid"

# also needs the pagespeed build flagset
nginx_pagespeed_enabled: true
nginx_pagespeed_cache_dir: /var/cache/pagespeed
nginx_pagespeed_log_dir: /var/log/pagespeed
nginx_pagespeed_filecachesizekb: 409600
nginx_pagespeed_lrucachekbperprocess: 8192
nginx_pagespeed_lrucachebytelimit: 16384

nginx_acl_stats:
  - 127.0.0.1

nginx_reinstall: false

nginx_install_dir : "/usr/local/nginx}"
nginx_config_dir : "/etc/{{  nginx_service_name }}"
nginx_log_dir : "/var/log/{{ nginx_service_name }}"

nginx_build_flags:
  - --user={{ nginx_user }}
  - --group={{ nginx_group }}
  - --prefix=/usr/local/nginx 
  - --sbin-path={{ nginx_bin }}
  - --conf-path={{ nginx_config_dir }}/nginx.conf
  - --error-log-path={{ nginx_log_dir }}/error.log
  - --http-log-path={{ nginx_log_dir }}/access.log
  - --http-client-body-temp-path=/var/lib/nginx/tmp/client_body
  - --http-proxy-temp-path=/var/lib/nginx/tmp/proxy
  - --http-fastcgi-temp-path=/var/lib/nginx/tmp/fastcgi
  - --lock-path=/var/lock/subsys/nginx
  - --pid-path={{ nginx_pid }}

nginx_build_extended_flags:
  - --with-http_image_filter_module
  - --with-http_addition_module
  - --with-http_ssl_module
  - --with-http_gzip_static_module
  - --with-http_stub_status_module
  - --with-http_geoip_module
  - --add-module={{ nginx_txid_module_path }}
  - --with-http_spdy_module
  - --with-google_perftools_module

nginx_build_optional_flags: "{% if nginx_pagespeed_build %} {{nginx_pagespeed_build_flag}} {% endif %} {% if nginx_naxsi_build %} {{ nginx_naxsi_build_flag }} {% endif %}"

nginx_debian_packages:
  - libpcre3
  - libpcre3-dev
  - libssl-dev
  - libgd2-xpm-dev
  - libgeoip-dev
  - google-perftools
  - libgoogle-perftools-dev

debian_build_essential:
  - autoconf
  - binutils-doc
  - bison
  - build-essential
  - flex
  - gettext
  - ncurses-dev

nginx_centos_packages:
  - libpcre3
  - libpcre3-dev
  - libssl-dev
  - libgd2-xpm-dev
  - libgeoip-dev
  - google-perftools
  - google-perftools-devel

# do we need to add this to centos for google-perftools
#rpm -Uvh http://pkgs.org/centos-6-rhel-6/epel-i386/pprof-2.0-3.el6.2.noarch.rpm.html

centos_build_essential:
  - autoconf
  - gcc
  - bison
  - flex
  - gcc-c++
  - gettext
  - kernel-devel
  - make
  - m4
  - ncurses-devel

# naxsi_module configuration
# https://github.com/nbs-system/naxsi
nginx_naxsi_build: false
nginx_naxsi_build_flag: "--add-module={{nginx_build_folder}}/naxsi-{{nginx_naxsi_version}}/naxsi_src"
nginx_naxsi_version: "0.53-2"
nginx_naxsi_url: "https://github.com/nbs-system/naxsi/archive/{{nginx_naxsi_version}}.tar.gz"
nginx_naxsi_enabled: false

# PageSpeed
# https://developers.google.com/speed/pagespeed/module/build_ngx_pagespeed_from_source
# http://ngxpagespeed.com/ngx_pagespeed_example/
# https://developers.google.com/speed/pagespeed/module/configuration
nginx_pagespeed_build: false
nginx_pagespeed_build_flag: "--add-module={{ nginx_build_folder}}/ngx_pagespeed-release-{{ nginx_pagespeed_version }}-beta"
nginx_pagespeed_version: 1.9.32.3
nginx_pagespeed_url: "https://github.com/pagespeed/ngx_pagespeed/archive/release-{{nginx_pagespeed_version}}-beta.zip"
nginx_pagespeec_psol_url: "https://dl.google.com/dl/page-speed/psol/{{nginx_pagespeed_version}}.tar.gz"

nginx_pagespeed_debian_packages:
  - build-essential
  - zlib1g-dev
  - libpcre3
  - libpcre3-dev
  - unzip

nginx_pagespeed_centos_packages:
  - gcc-c++
  - pcre-dev
  - pcre-devel
  - zlib-devel
  - make
  - unzip
